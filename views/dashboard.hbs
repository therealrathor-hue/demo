<div class="app-container">
  
  {{!-- <header class="topbar">
    <div class="user-info">
      <span>Logged in as <strong>{{user}}</strong></span>
    </div>
    <div class="action-section">
        <button id="openSendModal" class="btn primary-btn mr20">Send Notification</button>
        <form action="/logout" method="post">
            <button class="btn logout-btn">Logout</button>
        </form>
    </div>
  </header> --}}
    <header class="topbar">
        <div class="logo-title"><img src="/images/icon.png" class="avatar" alt="profile" /> Notification System</div>
        <div class="profile-container">
            <button id="openSendModal" class="btn primary-btn mr20">Send Notification</button>
            <img src="/images/profile.png" class="avatar" alt="profile" />   <!-- Replace with your image path -->
            <span class="profile-name">{{user}}</span>
            <span class="profile-arrow">â–¼</span>
            <ul class="profile-dropdown">
            <li><a href="/profile">Profile</a></li>
            <li><a href="/change-password">Change Password</a></li>
            <li><a href="/settings">Settings</a></li>
            <li>
                <form action="/logout" method="post">
                    <button class="dropdown-logout">Logout</button>
                </form>
            </li>
            </ul>
        </div>
    </header>

  <div id="sendModal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" id="closeSendModal">&times;</button>

        <h3 class="section-title">Send Notification</h3>

        <div class="form-group">
        <input id="sendToUser" class="input" placeholder="Receiver username" />
        </div>

        <div class="form-group">
        <textarea id="message" class="textarea" placeholder="Message"></textarea>
        </div>

        <button id="sendBtn" class="btn primary-btn full-width">Send</button>
        <small class="note">Socket and Push (if FCM token available)</small>
    </div>
    </div>

  <main class="content-wrapper">
    <section class="card history">
      <h3 class="section-title">Notification History</h3>

      <div class="table-wrapper">
        <table class="responsive-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>From</th>
              <th>To</th>
              <th>Message</th>
              <th>Socket</th>
              <th>Push</th>
            </tr>
          </thead>
          <tbody>
            {{#each notifications}}
              <tr>
                <td>{{formatDate this.createdAt}}</td>
                <td>{{this.from}}</td>
                <td>{{this.to}}</td>
                <td>{{this.message}}</td>
                <td>
                    <span class="status-label {{#if this.deliveredViaSocket}}success{{else}}failed{{/if}}">
                        {{yesNo this.deliveredViaSocket}}
                    </span>
                </td>
                <td>
                    <span class="status-label {{#if this.deliveredViaPush}}success{{else}}failed{{/if}}">
                        {{yesNo this.deliveredViaPush}}
                    </span>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

    </section>

  </main>
</div>

<script>
    const tw = document.querySelector('.table-wrapper');
    tw.scrollTop = tw.scrollHeight;
</script>
<script>
  const modal = document.getElementById("sendModal");
  const openBtn = document.getElementById("openSendModal");
  const closeBtn = document.getElementById("closeSendModal");

  openBtn.addEventListener("click", () => {
    modal.style.display = "flex";
  });

  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  window.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
</script>

<script>
    const pageUser = "{{user}}";
    const usernameEl = document.createElement("input");
    usernameEl.type = "hidden";
    usernameEl.id = "pageUsername";
    usernameEl.value = pageUser;
    document.body.appendChild(usernameEl);
</script>
